(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["protected/Slideshow"],{"53f7":function(e,t,o){"use strict";o("87be")},"87be":function(e,t,o){},a0f0:function(e,t,o){"use strict";o.r(t);var n=o("7a23");const s={class:"outer-wrap"},h=["src"],i={key:0,class:"newPhotoContainer"},c=["src"],l={class:"statsandcontrols"},d={key:0};function a(e,t,o,a,r,p){return Object(n["u"])(),Object(n["g"])(n["a"],null,[Object(n["h"])("div",s,[(Object(n["u"])(!0),Object(n["g"])(n["a"],null,Object(n["A"])(r.photoHtmlItems,e=>(Object(n["u"])(),Object(n["g"])("div",{class:"photoItemContainer",key:e.id},[e.photo?(Object(n["u"])(),Object(n["g"])("img",{class:"photoItem",src:"/uploaded/"+e.photo.filename,key:e.photo.filename,style:Object(n["q"])({left:e.photo.left+"px",top:e.photo.top+"px",zIndex:e.photo.zIndex})},null,12,h)):Object(n["f"])("",!0)]))),128))]),Object(n["j"])(n["b"],{name:"fade"},{default:Object(n["J"])(()=>[r.displayedNewPhoto?(Object(n["u"])(),Object(n["g"])("div",i,[Object(n["h"])("img",{src:"/uploaded/"+r.displayedNewPhoto.filename,style:Object(n["q"])({zIndex:r.zIndex+100})},null,12,c)])):Object(n["f"])("",!0)]),_:1}),Object(n["h"])("div",l,[Object(n["i"])(Object(n["E"])(r.displayedPhotos.length)+" ",1),Object(n["h"])("span",{style:{cursor:"pointer","font-size":"2em"},onClick:t[0]||(t[0]=(...e)=>p.addPhoto&&p.addPhoto(...e))},"ðŸŽ²"),Object(n["h"])("div",null,Object(n["E"])(r.photos.length)+" Fotos in der Sammlung",1),r.newPhotos.length>1?(Object(n["u"])(),Object(n["g"])("div",d,Object(n["E"])(r.newPhotos.length-1)+" Neue Fotos in der Warteschlange",1)):Object(n["f"])("",!0)])],64)}o("caad");var r=o("4ec3"),p=o("8c89"),u={name:"Home",data(){return{photos:[],displayedPhotos:[],newPhotos:[],displayedNewPhoto:null,readyForNewPhoto:!0,photoHtmlItems:[],zIndex:1}},watch:{photoHtmlItems:{handler(e,t){(t.length>=50||t.length==this.photos.length)&&(t.shift(),this.displayedPhotos.shift())},deep:!0},newPhotos:{handler(e,t){if(this.readyForNewPhoto&&t.length>0){console.log(this.readyForNewPhoto),this.readyForNewPhoto=!1;let e=this;e.displayedNewPhoto=t[0],setTimeout(()=>{console.log("first timeout"),e.displayedNewPhoto=null,setTimeout(()=>{console.log("inner timeout"),e.readyForNewPhoto=!0,e.newPhotos.shift()},2500)},6e3)}},deep:!0}},methods:{connectWebSocket(){let e=this;e.socket=new WebSocket(p["d"]+"/new_photos"),e.socket.onmessage=function(t){let o=JSON.parse(t.data);"add"===o.action?(e.photos.push(o.photo),e.newPhotos.push(o.photo)):"delete"===o.action?e.photos=e.photos.filter(e=>e.filename!=o.photo.filename):console.log('Websocket received unknown action "'+o.action+'".')},e.socket.onclose=function(){e.$store.commit("addNotification",{content:"Verbindung zum Server verloren.",color:"error",showTime:2e3}),console.log("WebSocket connection is closed. Attem,pting reconnect."),setTimeout((function(){e.connectWebSocket()}),1e3)},e.socket.onerror=function(t){console.log("WebSocket encountered error: "+t.message+"Closing Websocket."),e.socket.close()}},addPhoto(){let e=this.photos.filter(e=>!this.displayedPhotos.includes(e.filename)),t=Math.floor(Math.random()*e.length),o=e[t];o.left=Math.floor(Math.random()*this.maxLeft),o.top=Math.floor(Math.random()*this.minTop),o.zIndex=this.zIndex,this.zIndex++,this.photoHtmlItems.push({photo:o}),this.displayedPhotos.push(o.filename)},addEveryXseconds(e){this.addPhoto();let t=this;setTimeout(()=>{t.addEveryXseconds(e)},1e3*e)},calcDimensions(){let e=window.innerWidth,t=window.innerHeight;this.maxLeft=e/3*2,this.minTop=t/2}},mounted(){this.calcDimensions(),r["a"].getAllPhotos(this.$store.state.token).then(e=>{this.photos=e.data}).then(()=>{this.connectWebSocket()}).finally(()=>{this.addEveryXseconds(4)})},beforeUnmount(){this.socket.close()}},m=(o("53f7"),o("6b0d")),b=o.n(m);const f=b()(u,[["render",a]]);t["default"]=f}}]);
//# sourceMappingURL=Slideshow.ea22fdea.js.map