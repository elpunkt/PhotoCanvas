{"version":3,"sources":["webpack:///./src/views/main/protected/Slideshow.vue","webpack:///./src/views/main/protected/Slideshow.vue?a245","webpack:///./src/views/main/protected/Slideshow.vue?aa0f"],"names":["class","_createElementVNode","_createElementBlock","_Fragment","_renderList","$data","i","key","id","photo","src","filename","style","left","top","zIndex","transform","_createVNode","_Transition","name","length","onClick","$options","_toDisplayString","_hoisted_6","data","photos","displayedPhotos","newPhotos","displayedNewPhoto","readyForNewPhoto","photoHtmlItems","newDrop","undefined","watch","handler","oldList","newList","this","shift","deep","console","log","that","setTimeout","addEveryXseconds","methods","connectWebSocket","socket","WebSocket","wsUrl","onmessage","e","JSON","parse","action","push","filter","p","onclose","$store","commit","content","color","showTime","onerror","err","message","close","addPhoto","notDisplayed","includes","random","Math","floor","randomPhoto","maxLeft","minTop","X","calcDimensions","width","window","innerWidth","height","innerHeight","mounted","Api","getAllPhotos","state","token","then","resp","finally","beforeUnmount","__exports__","render"],"mappings":"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","file":"js/protected/Slideshow.814a9446.js","sourcesContent":["<template>\n  <div class=\"outer-wrap\">\n    <div class=\"photoItemContainer\" v-for=\"i in photoHtmlItems\"\n         :key=\"i.id\">\n           <img v-if=\"i.photo\"\n                class=\"photoItem\"\n                :class=\"i.photo.class\"\n                :src=\"`/uploaded/${i.photo.filename}`\"\n                :key=\"i.photo.filename\"\n                :style=\"{left: i.photo.left + 'px',\n                         top: i.photo.top + 'px',\n                         zIndex: i.photo.zIndex,\n                         transform: i.photo.transform,}\">\n    </div>\n  </div>\n  <transition name=\"fade\">\n    <div v-if=\"displayedNewPhoto\" class=\"newPhotoContainer\">\n      <img :src=\"`/uploaded/${displayedNewPhoto.filename}`\"\n           :style=\"{zIndex: zIndex + 100}\">\n    </div>\n  </transition>\n  <div class=\"statsandcontrols\">\n    {{displayedPhotos.length}}\n    <span style=\"cursor:pointer; font-size:2em;\" @click=\"addPhoto\">&#x1F3B2;</span>\n    <div> {{photos.length}} Fotos in der Sammlung</div>\n    <div v-if=\"newPhotos.length > 1\">{{newPhotos.length - 1}} Neue Fotos in der Warteschlange</div>\n    <!-- <div id=\"photoSelector\">\n        <img class=\"thumbnail\"\n               v-for=\"p in photos\"\n               :src=\"`/uploaded/${p.filename}`\"\n               :key=\"p.filename\"\n               @click=\"newPhotos.push(p)\"\n               :style=\"[newPhotos.includes(p) ? 'border: 3px solid orange;' : '']\">\n    </div> -->\n  </div>\n</template>\n\n<script>\nimport {Api} from \"@/api/api.js\";\nimport {wsUrl} from '@/env'\n\nexport default {\n  name: 'Home',\n  data() {\n    return {\n      photos: [],\n      displayedPhotos: [],\n      newPhotos: [],\n      displayedNewPhoto: null,\n      readyForNewPhoto: true,\n      photoHtmlItems: [],\n      zIndex: 1,\n      newDrop:undefined,\n    }\n  },\n  watch: {\n    photoHtmlItems: {\n      handler(oldList, newList) {\n        if ((newList.length >= 50) || newList.length == this.photos.length) {\n          newList.shift()\n          this.displayedPhotos.shift()\n        }\n      },\n      deep: true\n    },\n\n    newPhotos: {\n      handler(oldList, newList) {\n        if ((this.readyForNewPhoto) && (newList.length > 0)) {\n          console.log(this.readyForNewPhoto);\n          this.readyForNewPhoto = false;\n          let that = this\n          that.displayedNewPhoto = newList[0]\n          setTimeout(() => {\n            console.log('first timeout');\n            that.addEveryXseconds(5);\n            that.displayedNewPhoto = null;\n            setTimeout(() => {\n              console.log('inner timeout');\n              that.readyForNewPhoto = true;\n              that.newPhotos.shift()\n            }, 2500);\n          }, 6000);\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    connectWebSocket() {\n      let that = this\n      that.socket = new WebSocket(`${wsUrl}/new_photos`)\n      that.socket.onmessage = function(e) {\n        let data = JSON.parse(e.data)\n        if (data.action === 'add') {\n          // clearTimeout(that.newDrop);\n          that.photos.push(data.photo)\n          that.newPhotos.push(data.photo)\n          // that.$store.commit('addNotification', { content: 'Neues Foto', color: 'success' })\n        } else if (data.action === 'delete') {\n          that.photos = that.photos.filter((p) => p.filename != data.photo.filename)\n          // that.$store.commit('addNotification', { content: 'Ein Foto wurde entfernt.', color: 'success' })\n        } else {\n          console.log('Websocket received unknown action \"' + data.action + '\".');\n        }\n      }\n      that.socket.onclose = function() {\n        that.$store.commit('addNotification', { content: 'Verbindung zum Server verloren.', color: 'error', showTime: 2000 })\n        console.log('WebSocket connection is closed. Attem,pting reconnect.');\n        setTimeout(function() {that.connectWebSocket()}, 1000)\n      }\n      that.socket.onerror = function(err) {\n        console.log('WebSocket encountered error: ' + err.message + 'Closing Websocket.');\n        that.socket.close()\n      }\n    },\n    addPhoto() {\n      let notDisplayed = this.photos.filter((p) => !(this.displayedPhotos.includes(p.filename)))\n      let random = Math.floor(Math.random() * notDisplayed.length);\n      let randomPhoto = notDisplayed[random]\n      randomPhoto.left = Math.floor(Math.random()* this.maxLeft)\n      randomPhoto.top = Math.floor(Math.random()* this.minTop)\n      randomPhoto.class = undefined\n      randomPhoto.transform=(0.5-Math.random())<0?\"scale(2.5) rotate(-45deg)\":\"scale(2.5) rotate(45deg)\";\n      // randomPhoto.maxWidth = Math.floor(Math.random()* (120 - 100 +1) + 100)\n      // randomPhoto.maxHeight = Math.floor(Math.random()* (120 - 100 +1) + 100)\n      randomPhoto.zIndex = this.zIndex\n      this.zIndex ++\n      this.photoHtmlItems.push({photo: randomPhoto})\n      this.displayedPhotos.push(randomPhoto.filename)\n      setTimeout(()=>{\n        randomPhoto.transform = \"scale(1) rotate(\" + (-5 + (Math.random() * 10)) + \"deg)\";\n        randomPhoto.class = \"added\";\n      },500)\n    },\n    addEveryXseconds(X){\n      this.addPhoto()\n      let that = this;\n      this.newDrop = setTimeout(() => {\n        that.addEveryXseconds(X)\n      }, X * 1000);\n    },\n    calcDimensions() {\n      let width = window.innerWidth;\n      let height = window.innerHeight;\n      this.maxLeft = width/3*2\n      this.minTop = height/2\n    }\n  },\n  mounted() {\n    this.calcDimensions()\n    Api.getAllPhotos(this.$store.state.token)\n      .then(resp => {\n        this.photos = resp.data\n      })\n      .then(() => {\n        this.connectWebSocket()\n      })\n      .finally(() => {\n        this.addEveryXseconds(4)\n      })\n  },\n  beforeUnmount() {\n    this.socket.close()\n  }\n\n}\n</script>\n\n<style lang=\"scss\">\n#photoSelector {\n    background: black;\n    z-index: 9999999999999999;\n    position: fixed;\n    top: 0;\n    right: 0;\n    width: 10vw;\n    height: 100vh;\n    overflow-y: scroll;\n    img {\n      max-height: 10vh;\n\n    }\n  }\n  #header {\n    display: none;\n  }\n  .outer-wrap {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background-color: black;\n    display: grid;\n  }\n  .newPhotoContainer {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    -webkit-transform: translate(-50%, -50%);\n    transform: translate(-50%, -50%);\n    padding: 30px;\n    border: 5px solid #ff8300;\n    border-radius: 10px;\n    background-color: black;\n    img {\n      max-height: 90vh;\n      max-width: 90vw;\n    }\n  }\n\n  .statsandcontrols {\n    z-index: 99999999999999;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    color: white;\n    position: fixed;\n    bottom: 0;\n    right: 0;\n    font-size: 0.8rem;\n    font-family: Abel, sans-serif;\n  }\n\n  .photoItem {\n    position: fixed;\n    max-width: 30vw;\n    max-height: 50vh;\n    border: 5px solid white;\n    filter: drop-shadow(0 0 0.3rem white);\n    transition: all 1s, opacity 2s;\n    opacity: 0;\n  }\n  .photoItem.added {\n    opacity: 1;\n  }\n\n  .photoItemContainer {\n    width: 100vw;\n    height: 100vh;\n    position: fixed;\n    top: 0;\n    left: 0;\n    background-color: rgba(0,0,0,0.04);\n  }\n\n  .fade-enter-active,\n  .fade-leave-active {\n    transition: opacity 3s ease-in-out;\n  }\n\n  .fade-enter-from,\n  .fade-leave-to {\n    opacity: 0;\n  }\n</style>\n","import { render } from \"./Slideshow.vue?vue&type=template&id=0f0a9474\"\nimport script from \"./Slideshow.vue?vue&type=script&lang=js\"\nexport * from \"./Slideshow.vue?vue&type=script&lang=js\"\n\nimport \"./Slideshow.vue?vue&type=style&index=0&id=0f0a9474&lang=scss\"\n\nimport exportComponent from \"/home/elpunkt/Documents/PhotoCanvas/frontend/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Slideshow.vue?vue&type=style&index=0&id=0f0a9474&lang=scss\""],"sourceRoot":""}