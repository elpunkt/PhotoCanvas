{"version":3,"sources":["webpack:///./src/views/main/protected/Slideshow.vue?4f8d","webpack:///./src/views/main/protected/Slideshow.vue","webpack:///./src/views/main/protected/Slideshow.vue?a245"],"names":["class","_createElementVNode","style","gridTemplateRows","rows","gridTemplateColumns","cols","_createElementBlock","_Fragment","_renderList","$data","i","key","id","_createVNode","_Transition","name","photo","src","filename","maxHeight","maxWidth","marginTop","marginLeft","zIndex","data","photos","displayedPhotos","newPhotos","displayedNewPhoto","readyForNewPhoto","photoGridItems","watch","handler","oldList","newList","this","that","setTimeout","shift","deep","methods","connectWebSocket","socket","WebSocket","wsUrl","onmessage","e","JSON","parse","action","push","console","log","$store","commit","content","color","filter","p","onclose","showTime","onerror","err","message","close","replacePhoto","oldPhoto","random","Math","floor","length","randomPhoto","includes","replaceIn","splice","indexOf","calcDimensions","width","window","innerWidth","height","innerHeight","col","row","mounted","Api","getAllPhotos","state","token","then","resp","finally","forEach","beforeUnmount","__exports__","render"],"mappings":"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","file":"js/protected/Slideshow.6ff4a3c2.js","sourcesContent":["export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Slideshow.vue?vue&type=style&index=0&id=841b0f44&lang=scss\"","<template>\n  <div class=\"outer-wrap\" :style=\"{gridTemplateRows: 'repeat(' + this.rows + ', 1fr)', gridTemplateColumns: 'repeat(' + this.cols + ', 1fr)'}\">\n    <div v-for=\"i in photoGridItems\"\n         class=\"griditem\"\n         :key=\"i.id\">\n         <transition name=\"fade\">\n           <img v-if=\"i.photo\"\n                :src=\"`/uploaded/${i.photo.filename}`\"\n                :key=\"i.photo.filename\"\n                :style=\"{maxHeight: i.photo.maxHeight + '%',\n                         maxWidth: i.photo.maxWidth + '%',\n                         marginTop: i.photo.marginTop + 'px',\n                         marginLeft: i.photo.marginLeft + 'px',\n                         zIndex: i.photo.zIndex}\">\n         </transition>\n    </div>\n  </div>\n  <transition name=\"fade\">\n    <div v-if=\"displayedNewPhoto\" class=\"newPhotoContainer\">\n      <img :src=\"`/uploaded/${displayedNewPhoto.filename}`\"\n           :style=\"{zIndex: zIndex + 100}\">\n    </div>\n  </transition>\n</template>\n\n<script>\nimport {Api} from \"@/api/api.js\";\nimport {wsUrl} from '@/env'\n\nexport default {\n  name: 'Home',\n  data() {\n    return {\n      photos: [],\n      displayedPhotos: [],\n      newPhotos: [],\n      displayedNewPhoto: null,\n      readyForNewPhoto: true,\n      photoGridItems: [],\n      cols: 0,\n      rows: 0,\n      zIndex: 1\n    }\n  },\n  watch: {\n    newPhotos: {\n      handler(oldList, newList) {\n        if (this.readyForNewPhoto) {\n          this.readyForNewPhoto = false;\n          let that = this\n          that.displayedNewPhoto = newList[0]\n          setTimeout(() => {\n            that.displayedNewPhoto = null;\n            setTimeout(() => {\n              that.readyForNewPhoto = true;\n              that.newPhotos.shift()\n            }, 3000);\n          }, 6000);\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    connectWebSocket() {\n      let that = this\n      that.socket = new WebSocket(`${wsUrl}/new_photos`)\n      that.socket.onmessage = function(e) {\n        let data = JSON.parse(e.data)\n        if (data.action === 'add') {\n          that.photos.push(data.photo)\n          that.newPhotos.push(data.photo)\n          console.log(that.newPhotos);\n          that.$store.commit('addNotification', { content: 'Neues Foto', color: 'success' })\n        } else if (data.action === 'delete') {\n          that.photos = that.photos.filter((p) => p.filename != data.photo.filename)\n          that.$store.commit('addNotification', { content: 'Ein Foto wurde entfernt.', color: 'success' })\n        } else {\n          console.log('Websocket received unknown action \"' + data.action + '\".');\n        }\n      }\n      that.socket.onclose = function() {\n        that.$store.commit('addNotification', { content: 'Verbindung zum Server verloren.', color: 'error', showTime: 2000 })\n        console.log('WebSocket connection is closed. Attem,pting reconnect.');\n        setTimeout(function() {that.connectWebSocket()}, 1000)\n      }\n      that.socket.onerror = function(err) {\n        console.log('WebSocket encountered error: ' + err.message + 'Closing Websocket.');\n        that.socket.close()\n      }\n    },\n    replacePhoto(p) {\n      let oldPhoto = p.photo\n      let random = Math.floor(Math.random() * this.photos.length);\n      let randomPhoto = this.photos[random]\n      if (!(this.displayedPhotos.includes(randomPhoto.filename)) && !(randomPhoto === oldPhoto)) {\n        //random Margins in range -70 to 70\n        randomPhoto.marginTop = Math.floor(Math.random()*140-70)\n        randomPhoto.marginLeft = Math.floor(Math.random()*140-70)\n        // ranom MaxDimensions in range 100 to 120\n        randomPhoto.maxWidth = Math.floor(Math.random()* (120 - 100 +1) + 100)\n        randomPhoto.maxHeight = Math.floor(Math.random()* (120 - 100 +1) + 100)\n        randomPhoto.zIndex = this.zIndex\n        this.zIndex ++\n        p.photo = randomPhoto\n        this.displayedPhotos.push(randomPhoto.filename)\n        if (oldPhoto) {\n          this.displayedPhotos.splice(this.displayedPhotos.indexOf(oldPhoto.filename), 1)\n        }\n        var replaceIn = Math.floor(Math.random() * (20 - 10 + 1) + 10)\n      } else {\n        replaceIn = 1\n      }\n      // console.log(replaceIn);\n      let that = this;\n      setTimeout(function () {\n        that.replacePhoto(p)\n      }, replaceIn*1000);\n\n    },\n    calcDimensions() {\n      this.photoGridItems = [];\n      let width = window.innerWidth;\n      let height = window.innerHeight;\n      this.cols = Math.floor(width/480);\n      this.rows = Math.floor(height/480);\n      if (this.cols === 0) {\n        this.cols = 1;\n      }\n      if (this.rows === 0) {\n        this.rows = 1;\n      }\n      for (let col=0; col<this.cols; col ++) {\n        for (let row=0; row<this.rows; row++) {\n          this.photoGridItems.push({photo:null})\n        }\n      }\n    }\n  },\n  mounted() {\n    this.calcDimensions()\n    Api.getAllPhotos(this.$store.state.token)\n      .then(resp => {\n        this.photos = resp.data\n      })\n      .then(() => {\n        this.connectWebSocket()\n      })\n      .finally(() => {\n        this.photoGridItems.forEach((p) => {\n          this.replacePhoto(p)\n        });\n      })\n  },\n  beforeUnmount() {\n    this.socket.close()\n  }\n\n}\n</script>\n\n<style lang=\"scss\">\n  #header {\n    display: none;\n  }\n  .outer-wrap {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background-color: black;\n    display: grid;\n  }\n  .newPhotoContainer {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    -webkit-transform: translate(-50%, -50%);\n    transform: translate(-50%, -50%);\n    padding: 30px;\n    border: 5px solid #ff8300;\n    border-radius: 10px;\n    background-color: black;\n    img {\n      max-height: 90vh;\n      max-width: 90vw;\n    }\n  }\n  .griditem {\n    display: grid;\n    justify-items: center;\n    align-items: center;\n    position: relative;\n    & img {\n      position: absolute;\n      top: 0;\n      max-width: 100%;\n      max-height: 100%;\n    }\n  }\n\n  .fade-enter-active,\n  .fade-leave-active {\n    transition: opacity 3s ease-in-out;\n  }\n\n  .fade-enter-from,\n  .fade-leave-to {\n    opacity: 0;\n  }\n</style>\n","import { render } from \"./Slideshow.vue?vue&type=template&id=841b0f44\"\nimport script from \"./Slideshow.vue?vue&type=script&lang=js\"\nexport * from \"./Slideshow.vue?vue&type=script&lang=js\"\n\nimport \"./Slideshow.vue?vue&type=style&index=0&id=841b0f44&lang=scss\"\n\nimport exportComponent from \"/home/elpunkt/Documents/PhotoCanvas/frontend/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}